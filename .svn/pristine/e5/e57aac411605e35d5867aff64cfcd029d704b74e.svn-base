ctrl.startup = function() {
    ctrl.sel('.modal').modal('show');

    /* TODO: regForm 收合 */
};

ctrl.fillSession = function(siID) {
  ctrl.sel('select[name="siID"]').val(siID).focus();
  /* TODO: regForm 開啓 */
};

ctrl.regist = function() {
  var pdata = collectData();

  /* showRegRecipt */
  ctrl.sel('.modal').modal('show');
  ctrl.embed('.modal-content', '/notice', {params: pdata}, function(emCtrl) {
    emCtrl.addHandler("doReg", ctrl.doRegist);
  });
}

ctrl.doRegist = function() {
  var pdata = collectData();
  /*
    send api: attendee/register/[siID],
    with pdata but no token
    to regist.
  */
  var req = { url: '/bustime/attendee/register/'+pdata.siID, post: pdata };
  __.api(req, function(data) {
    if (data.errCode === 0) {
      alert('報名完成');
    } else
      alert('error: '+JSON.stringify(data));
  });

  /* TODO: clear form */
};

function collectData()  {
  var  pdata = { siID: ctrl.sel('select[name="siID"]').val(),
                 fname: ctrl.sel('input[name="fname"]').val(),
                 gender: ctrl.sel('select[name="gender"]').val(),
                 orgName: ctrl.sel('input[name="orgName"]').val(),
                 phone: ctrl.sel('input[name="phone"]').val(),
                 fax: ctrl.sel('input[name="fax"]').val(),
                 email: ctrl.sel('input[name="email"]').val(),
                 addr: ctrl.sel('input[name="addr"]').val(),
              };

  return  pdata;
};
